<app-navbar></app-navbar>

<div class="w-full min-h-[calc(100vh-60px)] mt-[60px] pt-12 pb-9 px-[5%] relative">

  <h1>Posts</h1>

  <app-message [confirmMessage]="confirmMessage" [errorMessage]="errorMessage"></app-message>

  <app-search label="Search for the post by title" (searchEvent)="searchPostTitle($event)"></app-search>
  <app-search label="Search for the post by text" (searchEvent)="searchPostText($event)"></app-search>

  <div *ngIf="posts.length > 0" class="my-10">
    <p><span class="text-[#c2185b]">Page:</span> {{currentPage}} of {{pages}}</p>
    <div class="mb-2"></div>
    <p><span class="text-[#c2185b]">Results:</span> {{paginationResults()}}</p>
  </div>

  <div *ngIf="posts.length > 0" class="my-10">
    <button (click)="previousPage()" mat-raised-button color="primary" [disabled]="currentPage === 1">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <span class="mr-4"></span>
    <button (click)="nextPage()" mat-raised-button color="primary"
      [disabled]="this.posts.length !== this.resultsPerPage">
      <mat-icon>arrow_forward</mat-icon>
    </button>
  </div>

  <div *ngIf="posts.length > 0" class="mt-10">
    <ul>
      <li *ngFor="let post of posts">
        <mat-divider></mat-divider>
        <article class="my-6">
          <h2>{{ post.title }}</h2>
          <p>{{ post.body }}</p>
        </article>

        <div class="my-6">
          <button mat-raised-button color="primary" (click)="getPostComments(post.id)" [disabled]="modalComments">
            <mat-icon>comment</mat-icon>
          </button>
        </div>

        <div *ngIf="selectedPostId === post.id && modalComments" class="my-10 relative">

          <div class="absolute top-[12px] left-[calc(100%-48px)] lg:left-[calc(50%-48px)] z-[1]">
            <mat-icon (click)="closeComments(); formDirective.resetForm();"
              class="bg-[#c2185b] text-white rounded cursor-pointer">close</mat-icon>
          </div>

          <div class="w-full lg:w-1/2 mb-10">
            <mat-accordion>
              <mat-expansion-panel hideToggle>
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <span class="pt-0.5">Add Post</span>
                  </mat-panel-title>
                  <mat-panel-description>
                  </mat-panel-description>
                </mat-expansion-panel-header>

                <form [formGroup]="postForm" #formDirective="ngForm">
                  <mat-form-field class="min-w-[250px]">
                    <mat-label>Title</mat-label>
                    <input matInput value="" type="text" formControlName="title">
                  </mat-form-field>

                  <div>
                    <mat-form-field class="w-full max-w-[500px]">
                      <mat-label>Text</mat-label>
                      <textarea matInput type="text" formControlName="body"></textarea>
                    </mat-form-field>
                  </div>

                  <button type="submit" mat-raised-button color="primary" [disabled]="!postForm.valid"
                    (click)="addPost(post.user_id, formDirective)">
                    <mat-icon>add</mat-icon>
                  </button>
                </form>

              </mat-expansion-panel>
            </mat-accordion>
          </div>

          <h4 class="px-6">Comments ({{comments.length}})</h4>
          <div *ngIf="comments.length > 0" class="px-6">
            <div *ngFor="let comment of comments" class="mt-7 flex justify-start items-start">
              <div>
                <mat-icon>person</mat-icon>&nbsp;
              </div>
              <div>
                <div class="mb-1">
                  <small class="bg-[#202124] break-all p-1 rounded">
                    {{comment.name}} - {{comment.email}}
                  </small>
                </div>
                <p>{{comment.body}}</p>
              </div>
            </div>
          </div>

        </div>

      </li>
    </ul>
  </div>

  <app-spinner [showSpinner]="spinner"></app-spinner>

</div>
